import{i as e}from"./vuetify-C9xgp6aa.js";import{_ as t,e as a}from"./_plugin-vue_export-helper-CdH3CoQy.js";const{toDisplayString:l,createTextVNode:s,resolveComponent:r,withCtx:c,createVNode:n,openBlock:i,createBlock:o,createCommentVNode:d,createElementBlock:u,normalizeClass:p,createElementVNode:f}=await e("vue"),v={class:"dashboard-widget"},m={key:0,class:"text-center py-2"},g={key:1,class:"text-error text-caption d-flex align-center"},_={key:2},x={key:3,class:"text-caption text-disabled text-center py-2"},y={class:"text-caption text-disabled"},{ref:h,reactive:b,onMounted:k,onUnmounted:w,computed:S}=await e("vue"),z=t({__name:"Dashboard",props:{api:{type:[Object,Function],required:!0},config:{type:Object,default:()=>({attrs:{}})},allowRefresh:{type:Boolean,default:!1},refreshInterval:{type:Number,default:0}},setup(e){const t=e,z=h(!1),I=h(null),C=h(!1),N=h(null),j=b({enabled:!1,has_client:!1,running:!1});let B=null;async function D(){z.value=!0,I.value=null;try{const e="P115StrmHelper",a=await t.api.get(`plugin/${e}/get_status`);if(!a||0!==a.code||!a.data)throw new Error(a?.msg||"获取状态失败");j.enabled=a.data.enabled,j.has_client=a.data.has_client,j.running=a.data.running,C.value=!0,N.value=Date.now()}catch(e){console.error("获取仪表盘数据失败:",e),I.value=e.message||"获取数据失败"}finally{z.value=!1}}const R=S(()=>{if(!N.value)return"";const e=new Date(N.value);return`更新于: ${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}:${e.getSeconds().toString().padStart(2,"0")}`});return k(()=>{a(),D(),t.refreshInterval>0&&(B=setInterval(D,1e3*t.refreshInterval))}),w(()=>{B&&(clearInterval(B),B=null)}),(e,a)=>{const h=r("v-card-title"),b=r("v-card-subtitle"),k=r("v-card-item"),w=r("v-progress-circular"),S=r("v-icon"),N=r("v-list-item-title"),B=r("v-list-item"),V=r("v-list"),$=r("v-card-text"),E=r("v-divider"),M=r("v-spacer"),H=r("v-btn"),O=r("v-card-actions"),T=r("v-card");return i(),u("div",v,[n(T,{flat:!t.config?.attrs?.border,loading:z.value,class:"fill-height d-flex flex-column"},{default:c(()=>[t.config?.attrs?.title||t.config?.attrs?.subtitle?(i(),o(k,{key:0},{default:c(()=>[n(h,null,{default:c(()=>[s(l(t.config?.attrs?.title||"115网盘STRM助手"),1)]),_:1}),t.config?.attrs?.subtitle?(i(),o(b,{key:0},{default:c(()=>[s(l(t.config.attrs.subtitle),1)]),_:1})):d("",!0)]),_:1})):d("",!0),n($,{class:"flex-grow-1 pa-3"},{default:c(()=>[z.value&&!C.value?(i(),u("div",m,[n(w,{indeterminate:"",color:"primary",size:"small"})])):I.value?(i(),u("div",g,[n(S,{size:"small",color:"error",class:"mr-1"},{default:c(()=>a[0]||(a[0]=[s("mdi-alert-circle-outline")])),_:1}),s(" "+l(I.value||"数据加载失败"),1)])):C.value?(i(),u("div",_,[n(V,{density:"compact",class:"py-0"},{default:c(()=>[n(B,{class:"pa-0"},{prepend:c(()=>[n(S,{size:"small",color:j.enabled?"success":"grey",class:"mr-2"},{default:c(()=>[s(l(j.enabled?"mdi-check-circle":"mdi-close-circle"),1)]),_:1},8,["color"])]),default:c(()=>[n(N,{class:"text-caption"},{default:c(()=>[a[1]||(a[1]=s(" 插件状态: ")),f("span",{class:p(j.enabled?"text-success":"text-grey")},l(j.enabled?"已启用":"已禁用"),3)]),_:1})]),_:1}),n(B,{class:"pa-0"},{prepend:c(()=>[n(S,{size:"small",color:j.has_client?"success":"error",class:"mr-2"},{default:c(()=>[s(l(j.has_client?"mdi-account-check":"mdi-account-off"),1)]),_:1},8,["color"])]),default:c(()=>[n(N,{class:"text-caption"},{default:c(()=>[a[2]||(a[2]=s(" 115客户端: ")),f("span",{class:p(j.has_client?"text-success":"text-error")},l(j.has_client?"已连接":"未连接"),3)]),_:1})]),_:1}),n(B,{class:"pa-0"},{prepend:c(()=>[n(S,{size:"small",color:j.running?"success":"grey",class:"mr-2"},{default:c(()=>[s(l(j.running?"mdi-play-circle":"mdi-pause-circle"),1)]),_:1},8,["color"])]),default:c(()=>[n(N,{class:"text-caption"},{default:c(()=>[a[3]||(a[3]=s(" 任务状态: ")),f("span",{class:p(j.running?"text-success":"text-grey")},l(j.running?"运行中":"空闲"),3)]),_:1})]),_:1})]),_:1})])):(i(),u("div",x," 暂无数据 "))]),_:1}),t.allowRefresh?(i(),o(E,{key:1})):d("",!0),t.allowRefresh?(i(),o(O,{key:2,class:"px-3 py-1 refresh-actions"},{default:c(()=>[f("span",y,l(R.value),1),n(M),n(H,{icon:"",variant:"text",size:"small",onClick:D,loading:z.value},{default:c(()=>[n(S,{size:"small"},{default:c(()=>a[4]||(a[4]=[s("mdi-refresh")])),_:1})]),_:1},8,["loading"])]),_:1})):d("",!0)]),_:1},8,["flat","loading"])])}}},[["__scopeId","data-v-86791aeb"]]);export{z as default};
